import { Router } from "express";
import middlewareHandler from "../../src/middlewares/_middleware.js";
import control from "../../src/utils/control.js";
import sanitizeAndValidate from "../../src/validations/_validate.js";
import customerController from "../../src/controllers/customerController.js";
import customerValidation from "../../src/validations/customerValidation.js";
import { loadFileInMemory, uploadFileToS3 } from "../../src/services/fileService.js";
export const router = Router();
router.get("/", control(customerController.index));
router.get("/:customerId", middlewareHandler("auth"), sanitizeAndValidate(customerValidation.selectedCustomer), control(customerController.selected));
router.post("/", middlewareHandler("auth"), loadFileInMemory("pelanggan_data_file", customerValidation.customerDataValidation), sanitizeAndValidate(customerValidation.createCustomer), uploadFileToS3("customerData", "pelanggan_data_file"), control(customerController.create));
router.put("/:customerId", middlewareHandler("auth"), loadFileInMemory("pelanggan_data_file", customerValidation.customerDataValidation), sanitizeAndValidate(customerValidation.updateCustomer), uploadFileToS3("customerData", "pelanggan_data_file"), control(customerController.update));
router.patch("/:customerId", middlewareHandler("auth"), loadFileInMemory("pelanggan_data_file"), sanitizeAndValidate(customerValidation.updateCustomer), uploadFileToS3("customerData", "pelanggan_data_file"), control(customerController.update));
router.delete("/:customerId", middlewareHandler("auth"), sanitizeAndValidate(customerValidation.destroyCustomer), control(customerController.destroy));
export default router;
